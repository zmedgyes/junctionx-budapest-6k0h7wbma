<template>
<div>
<div class="bmenuContainer">
  <DailyBox @cancel="this.dailyIsOpen = false" v-if="dailyIsOpen" />
  <QRScan v-if="qrIsOpen"
    @closeQR="this.qrIsOpen = false"
    @onQRDecode="onQRScan" />
  <UserMessagee v-if="userMessage.isVisible"
    :userMessageInfo="userMessage"
    @closeUserMessage="closeMessage"/>
    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
    viewBox="0 0 1125 250" style="enable-background:new 0 0 1125 250;" xml:space="preserve">
    <g>
      
        <image style="overflow:visible;opacity:0.1;" width="1156" height="201" xlink:href="/img/FCFDE698.png"  transform="matrix(1 0 0 1 -15.5 54.5895)">
      </image>
      <g>
        <path class="st0" d="M1050,80H742.5c-33.2,0-61.3,21.6-71.2,51.4c-0.5,2.2-1.1,4.3-1.8,6.4c-14.3,45.5-56.8,78.4-107,78.4
          s-92.7-33-107-78.4c-0.7-2.1-1.3-4.2-1.8-6.4c-9.9-29.9-38-51.4-71.2-51.4H75H0v75v95h75h307.5h360H1050h75v-95V80H1050z"/>
      </g>
    </g>
    <g data-bs-toggle="offcanvas" data-bs-target="#offcanvasBottom" aria-controls="offcanvasBottom">
      <g>
        
          <image style="overflow:visible;opacity:0.3;" width="248" height="249" xlink:href="/img/FCFDE699.png"  transform="matrix(1 0 0 1 438.5 -24.4105)">
        </image>
        <g>
          <circle class="st0" cx="562.5" cy="100" r="100"/>
        </g>
      </g>
      <g>
        <path class="st1" d="M637.5,100c0,41.4-33.6,75-75,75s-75-33.6-75-75s33.6-75,75-75S637.5,58.6,637.5,100z"/>
        <path class="st0" d="M563.1,141.6c-20.5,0.1-41.8-17.4-41.9-45.5c-0.1-18.6,9.9-36.4,22.7-47c12.5-10.3,29.6-17,45.1-17
          c2,0,4.1,0.2,5.4,0.6c-13.6,2.8-24.4,15.4-24.3,29.8v0c0,0.4,0,0.8,0.1,1.2v0c22.7,5.5,33,19.2,33.1,38.2S588.4,141.5,563.1,141.6
          L563.1,141.6z"/>
      </g>
    </g>
    <path class="st2" d="M455.5,137.8c-0.5-2.2-1.1-4.3-1.8-6.4C454.2,133.6,454.8,135.7,455.5,137.8z"/>
    <path class="st2" d="M671.3,131.4c-0.7,2.1-1.3,4.2-1.8,6.4C670.2,135.7,670.8,133.6,671.3,131.4z"/>
    <g>
      <g>
        <path d="M118.7,187.8c1.3,0.5,2.5,1.3,3.7,2.4l-1.9,2.1c-1-0.8-2.1-1.4-3.1-1.8c-1-0.4-2.1-0.6-3.3-0.6c-1.5,0-2.8,0.4-3.7,1.1
          c-0.9,0.7-1.4,1.7-1.4,3c0,0.9,0.2,1.6,0.5,2.1c0.3,0.6,0.9,1.1,1.8,1.5s2.1,1,3.8,1.5c1.7,0.5,3.2,1.1,4.3,1.7
          c1.1,0.6,2.1,1.5,2.7,2.5c0.7,1.1,1,2.4,1,4c0,1.6-0.4,3-1.2,4.2c-0.8,1.2-1.9,2.2-3.3,2.9s-3.2,1-5.1,1c-3.7,0-6.8-1.2-9.2-3.5
          l2-2.2c1.1,0.9,2.2,1.6,3.4,2.1c1.1,0.5,2.4,0.7,3.9,0.7c1.8,0,3.2-0.4,4.4-1.3c1.1-0.9,1.7-2.2,1.7-3.8c0-1-0.2-1.8-0.5-2.4
          s-1-1.2-1.8-1.7c-0.9-0.5-2.1-1-3.7-1.4c-2.8-0.9-4.9-1.9-6.2-3.1s-1.9-2.8-1.9-4.8c0-1.4,0.4-2.6,1.1-3.7s1.7-1.9,3-2.5
          c1.3-0.6,2.8-0.9,4.4-0.9C115.9,187,117.4,187.3,118.7,187.8z"/>
        <path d="M144.4,215h-2.9l-0.3-3.4c-0.8,1.3-1.7,2.3-2.8,2.9c-1.1,0.6-2.3,1-3.8,1c-1.9,0-3.3-0.6-4.3-1.7s-1.5-2.7-1.5-4.8V194
          h3.4v14.7c0,1.5,0.3,2.6,0.8,3.2s1.4,0.9,2.6,0.9c2.2,0,4-1.3,5.5-3.8V194h3.4V215z"/>
        <path d="M167.3,196.4c1.4,1.9,2.1,4.6,2.1,8.1c0,2.2-0.3,4.2-1,5.8c-0.7,1.7-1.6,3-2.8,3.9s-2.7,1.4-4.4,1.4c-2.3,0-4.2-1-5.7-2.9
          l-0.4,2.4h-2.9v-29.5l3.4-0.4v11.6c1.5-2.1,3.6-3.2,6-3.2C164,193.5,165.9,194.4,167.3,196.4z M164.3,210.7
          c0.9-1.4,1.4-3.5,1.4-6.3c0-5.5-1.7-8.3-5.1-8.3c-1.9,0-3.7,1.1-5.1,3.4v10.3c0.6,0.9,1.3,1.6,2.1,2.2c0.8,0.5,1.7,0.8,2.7,0.8
          C162.1,212.8,163.4,212.1,164.3,210.7z"/>
        <path d="M185.2,194.1c1.1,0.4,2.2,1,3.3,1.8L187,198c-1-0.6-1.9-1.1-2.7-1.4c-0.9-0.3-1.8-0.4-2.8-0.4c-1.3,0-2.2,0.3-3,0.8
          c-0.7,0.5-1.1,1.3-1.1,2.2c0,0.9,0.3,1.6,1,2.1c0.7,0.5,1.9,1,3.7,1.5c2.3,0.6,4.1,1.4,5.2,2.4c1.1,1,1.7,2.4,1.7,4.1
          c0,2-0.8,3.6-2.4,4.7c-1.6,1.1-3.5,1.6-5.8,1.6c-3.1,0-5.8-0.9-7.9-2.8l1.8-2c1.9,1.4,3.9,2.1,6,2.1c1.4,0,2.5-0.3,3.4-0.9
          c0.9-0.6,1.3-1.4,1.3-2.5c0-0.7-0.1-1.4-0.4-1.8c-0.3-0.5-0.8-0.9-1.5-1.2c-0.7-0.3-1.8-0.7-3.3-1.1c-2.2-0.6-3.9-1.4-4.8-2.3
          s-1.5-2.2-1.5-3.7c0-1.1,0.3-2.1,1-2.9c0.6-0.9,1.5-1.5,2.7-2c1.1-0.5,2.4-0.7,3.8-0.7C182.8,193.5,184.1,193.7,185.2,194.1z"/>
        <path d="M205.4,194c1,0.3,2,0.9,2.9,1.7l-1.6,2.1c-0.7-0.5-1.4-0.9-2.2-1.2c-0.7-0.3-1.5-0.4-2.4-0.4c-1.8,0-3.1,0.7-4.1,2.1
          c-1,1.4-1.5,3.5-1.5,6.2c0,2.7,0.5,4.7,1.5,6c1,1.3,2.4,2,4.2,2c0.9,0,1.6-0.1,2.3-0.4s1.5-0.7,2.3-1.2l1.6,2.2
          c-1.8,1.5-3.9,2.3-6.3,2.3c-2.8,0-5.1-1-6.7-2.9c-1.6-1.9-2.4-4.6-2.4-8c0-2.2,0.4-4.2,1.1-5.9c0.7-1.7,1.8-3,3.2-3.9
          c1.4-0.9,3-1.4,4.9-1.4C203.3,193.5,204.4,193.7,205.4,194z"/>
        <path d="M224.5,193.7l-0.6,3.3c-0.6-0.2-1.3-0.2-1.8-0.2c-1.3,0-2.4,0.5-3.2,1.5c-0.8,1-1.5,2.5-1.9,4.6V215h-3.4v-21h2.9l0.3,4.4
          c0.6-1.6,1.3-2.8,2.3-3.6c1-0.8,2.1-1.2,3.4-1.2C223.2,193.5,223.9,193.6,224.5,193.7z"/>
        <path d="M232.2,184.7c0.4,0.4,0.7,1,0.7,1.7s-0.2,1.2-0.7,1.7c-0.4,0.4-1,0.7-1.7,0.7c-0.7,0-1.3-0.2-1.7-0.7
          c-0.4-0.4-0.7-1-0.7-1.7s0.2-1.2,0.7-1.7c0.4-0.4,1-0.7,1.7-0.7C231.2,184,231.8,184.3,232.2,184.7z M232.2,215h-3.4v-21h3.4V215z
          "/>
        <path d="M255.3,196.3c1.3,1.9,1.9,4.6,1.9,8.1c0,3.3-0.7,6-2.1,8c-1.4,2-3.4,3-6.1,3c-2.4,0-4.2-0.8-5.6-2.5V223l-3.4,0.4V194h2.9
          l0.2,2.9c0.8-1.1,1.7-1.9,2.8-2.5c1.1-0.6,2.3-0.9,3.5-0.9C252.1,193.5,254,194.4,255.3,196.3z M253.6,204.4c0-5.5-1.7-8.3-5-8.3
          c-1.1,0-2,0.3-2.9,0.9c-0.9,0.6-1.7,1.4-2.3,2.4V210c0.6,0.9,1.3,1.6,2.1,2c0.8,0.5,1.7,0.7,2.8,0.7
          C251.8,212.7,253.6,210,253.6,204.4z"/>
        <path d="M274,214.1c-1.4,0.9-2.9,1.4-4.6,1.4c-1.8,0-3.1-0.5-4.1-1.5c-1-1-1.5-2.5-1.5-4.4v-13h-3.6V194h3.6v-4.8l3.4-0.4v5.2h5.1
          l-0.4,2.6h-4.7v12.9c0,1.1,0.2,1.9,0.6,2.5c0.4,0.5,1.1,0.8,2,0.8c1,0,1.9-0.3,2.9-0.9L274,214.1z"/>
        <path d="M281.3,184.7c0.4,0.4,0.7,1,0.7,1.7s-0.2,1.2-0.7,1.7c-0.4,0.4-1,0.7-1.7,0.7c-0.7,0-1.3-0.2-1.7-0.7
          c-0.4-0.4-0.7-1-0.7-1.7s0.2-1.2,0.7-1.7c0.4-0.4,1-0.7,1.7-0.7C280.2,184,280.8,184.3,281.3,184.7z M281.2,215h-3.4v-21h3.4V215z
          "/>
        <path d="M303.6,196.4c1.6,2,2.4,4.6,2.4,8c0,3.4-0.8,6-2.5,8c-1.6,2-3.9,3-6.8,3c-2.9,0-5.2-1-6.8-2.9c-1.6-2-2.4-4.6-2.4-8
          c0-3.4,0.8-6,2.5-8s3.9-3,6.8-3C299.7,193.5,302,194.5,303.6,196.4z M292.5,198.3c-1,1.4-1.5,3.5-1.5,6.2c0,2.7,0.5,4.8,1.4,6.2
          c1,1.4,2.4,2.1,4.2,2.1c1.8,0,3.2-0.7,4.2-2.1c1-1.4,1.5-3.5,1.5-6.2c0-2.7-0.5-4.8-1.4-6.2c-1-1.4-2.4-2.1-4.2-2.1
          C294.9,196.2,293.5,196.9,292.5,198.3z"/>
        <path d="M326.5,195.2c1.1,1.1,1.6,2.7,1.6,4.7V215h-3.4v-14.6c0-1.5-0.3-2.6-0.9-3.3c-0.6-0.7-1.5-1-2.6-1c-1.2,0-2.2,0.3-3.1,1
          c-0.9,0.7-1.7,1.6-2.5,2.9v15h-3.4v-21h2.9l0.3,3.2c0.8-1.1,1.8-2,2.9-2.7s2.4-1,3.7-1C324,193.5,325.5,194.1,326.5,195.2z"/>
        <path d="M345,194.1c1.1,0.4,2.2,1,3.3,1.8l-1.4,2.1c-1-0.6-1.9-1.1-2.7-1.4c-0.9-0.3-1.8-0.4-2.8-0.4c-1.3,0-2.2,0.3-3,0.8
          c-0.7,0.5-1.1,1.3-1.1,2.2c0,0.9,0.3,1.6,1,2.1c0.7,0.5,1.9,1,3.7,1.5c2.3,0.6,4.1,1.4,5.2,2.4c1.1,1,1.7,2.4,1.7,4.1
          c0,2-0.8,3.6-2.4,4.7c-1.6,1.1-3.5,1.6-5.8,1.6c-3.1,0-5.8-0.9-7.9-2.8l1.8-2c1.9,1.4,3.9,2.1,6,2.1c1.4,0,2.5-0.3,3.4-0.9
          c0.9-0.6,1.3-1.4,1.3-2.5c0-0.7-0.1-1.4-0.4-1.8c-0.3-0.5-0.8-0.9-1.5-1.2c-0.7-0.3-1.8-0.7-3.3-1.1c-2.2-0.6-3.9-1.4-4.8-2.3
          s-1.5-2.2-1.5-3.7c0-1.1,0.3-2.1,1-2.9c0.6-0.9,1.5-1.5,2.7-2c1.1-0.5,2.4-0.7,3.8-0.7C342.6,193.5,343.9,193.7,345,194.1z"/>
      </g>
      <g id="Layer_4_3_">
        <g>
          <path d="M242.2,174.1h-30.8c-2,0-3.7-1.6-3.7-3.7v-57.7c0-2,1.6-3.7,3.7-3.7h18.1c0.5,0,1,0.2,1.3,0.6l14.5,14.5
            c0.3,0.3,0.6,0.8,0.6,1.3v45C245.9,172.4,244.3,174.1,242.2,174.1z M211.5,170.3h30.6v-44.1l-13.4-13.4h-17.2V170.3z"/>
        </g>
        <g>
          <path d="M231.5,162.9h-9.3c-2,0-3.7-1.6-3.7-3.7V140c0-2,1.6-3.7,3.7-3.7h9.3c2,0,3.7,1.6,3.7,3.7v19.3
            C235.1,161.3,233.5,162.9,231.5,162.9z M222.3,159.2h9.1V140h-9.1V159.2z"/>
        </g>
        <g>
          <line class="st3" x1="244.1" y1="141.6" x2="244" y2="141.5"/>
        </g>
      </g>
    </g>
    <g>
      <g>
        <path d="M858.5,189.6c1.8,1.4,2.8,3.5,2.8,6.3c0,3-1,5.2-2.9,6.7c-1.9,1.5-4.5,2.2-7.7,2.2h-3.6V215h-3.4v-27.5h7
          C854,187.5,856.6,188.2,858.5,189.6z M855.8,200.7c1.2-0.9,1.8-2.5,1.8-4.7c0-2-0.6-3.5-1.8-4.4c-1.2-0.9-2.9-1.4-5.1-1.4h-3.6
          V202h3.5C852.8,202,854.6,201.6,855.8,200.7z"/>
        <path d="M877.5,193.7l-0.6,3.3c-0.6-0.2-1.3-0.2-1.8-0.2c-1.3,0-2.4,0.5-3.2,1.5c-0.8,1-1.5,2.5-1.9,4.6V215h-3.4v-21h2.9l0.3,4.4
          c0.6-1.6,1.3-2.8,2.3-3.6c1-0.8,2.1-1.2,3.4-1.2C876.2,193.5,876.9,193.6,877.5,193.7z"/>
        <path d="M896,196.4c1.6,2,2.4,4.6,2.4,8c0,3.4-0.8,6-2.5,8c-1.6,2-3.9,3-6.8,3s-5.2-1-6.8-2.9c-1.6-2-2.4-4.6-2.4-8
          c0-3.4,0.8-6,2.5-8c1.6-2,3.9-3,6.8-3C892.1,193.5,894.4,194.5,896,196.4z M885,198.3c-1,1.4-1.5,3.5-1.5,6.2
          c0,2.7,0.5,4.8,1.4,6.2c1,1.4,2.4,2.1,4.2,2.1s3.2-0.7,4.2-2.1c1-1.4,1.5-3.5,1.5-6.2c0-2.7-0.5-4.8-1.4-6.2
          c-1-1.4-2.4-2.1-4.2-2.1S885.9,196.9,885,198.3z"/>
        <path d="M917.6,186.5l-1.2,2.4c-1.4-0.7-3-1.1-4.6-1.1c-1.4,0-2.4,0.3-2.9,0.8c-0.6,0.5-0.8,1.3-0.8,2.5v2.9h11.8v21h-3.4v-18.4
          H908V215h-3.4v-18.4h-3.4V194h3.4V191c0-1.8,0.6-3.3,1.7-4.4c1.2-1.1,2.9-1.6,5.3-1.6C913.7,185.1,915.7,185.6,917.6,186.5z"/>
        <path d="M928.5,214.3c-0.7-0.8-1.1-1.9-1.1-3.3v-25.5l3.4-0.4v25.8c0,0.6,0.1,1,0.3,1.3c0.2,0.3,0.6,0.4,1.1,0.4
          c0.5,0,1-0.1,1.4-0.2l0.9,2.4c-0.9,0.5-1.8,0.7-2.8,0.7C930.3,215.5,929.3,215.1,928.5,214.3z"/>
        <path d="M954.4,205.6h-13.6c0.2,2.4,0.8,4.2,1.8,5.4c1,1.1,2.4,1.7,4.1,1.7c1,0,2-0.1,2.8-0.4c0.9-0.3,1.7-0.8,2.7-1.4l1.5,2
          c-2.2,1.8-4.6,2.6-7.2,2.6c-2.9,0-5.1-1-6.8-2.9c-1.6-1.9-2.4-4.6-2.4-7.9c0-2.2,0.3-4.1,1-5.8c0.7-1.7,1.7-3,3-4
          c1.3-0.9,2.8-1.4,4.6-1.4c2.8,0,4.9,0.9,6.4,2.7c1.5,1.8,2.2,4.4,2.2,7.6C954.5,204.4,954.4,205.1,954.4,205.6z M951.2,202.8
          c0-2.2-0.4-3.8-1.3-5c-0.9-1.1-2.2-1.7-3.9-1.7c-1.5,0-2.7,0.6-3.6,1.7c-0.9,1.1-1.4,2.9-1.5,5.3h10.3V202.8z"/>
      </g>
      <g>
        <circle class="st3" cx="898.2" cy="127.6" r="14.5"/>
        <path d="M907.7,143.5c5.4-3.2,9-9.2,9-15.9c0-10.2-8.3-18.5-18.5-18.5s-18.5,8.3-18.5,18.5c0,6.7,3.6,12.7,9,15.9
          c-13,4.1-22.5,16.2-22.5,30.6h4.1c0-15.4,12.5-27.9,27.9-27.9s27.9,12.5,27.9,27.9h4.1C930.2,159.7,920.7,147.6,907.7,143.5z
          M883.7,127.6c0-8,6.5-14.5,14.5-14.5s14.5,6.5,14.5,14.5s-6.5,14.5-14.5,14.5S883.7,135.6,883.7,127.6z"/>
      </g>
    </g>
    </svg>
</div>
<div class="offcanvas offcanvas-bottom" tabindex="-1" id="offcanvasBottom" aria-labelledby="offcanvasBottomLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="offcanvasBottomLabel">You have a {{streak}} day long streak</h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <div class="container">
      <div class="row">
        <div class="col">
          <router-link tag="button" :to="{name : 'Home'}">
            <OffcanvasCard
              mainText="Bact to Home Page"
              subText=" "
              icon="home"
              initStyle="default"
            />
          </router-link>
        </div>
        <div class="col">
          <div @click="openQRScan">
            <OffcanvasCard
              mainText="Redeem a QR code!"
              subText="Read the QR code. Click here"
              icon="scan"
              initStyle="red"
            />
          </div>
        </div>
        <div class="col">
          <router-link tag="button" :to="{name : 'PointShop'}">
            <OffcanvasCard
              mainText="Exchange points"
              subText="Activate valuable services"
              icon="daily"
              initStyle="red"
            />
          </router-link>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
</template>

<script>
import { getStreak } from "../remotes/remotes"
import OffcanvasCard from "../components/cards/OffcanvasCard.vue"
import DailyBox from "../components/DailyBox.vue"
import QRScan from "../components/QRScan.vue"
import UserMessagee from "../components/UserMessagee.vue"
import { verifyQR } from "../remotes/remotes"
import { USER_ID } from "../misc/user"
export default {
    components: {
        OffcanvasCard, DailyBox, QRScan, UserMessagee
    },
    data () {
    return {
      streak:0,
      dailyIsOpen: false,
      qrIsOpen: false, 
      userMessage:{
        isVisible:false,
        mainMessage:"This is some messgage",
        subMessage:"Damn thats a pretty good submesssage",
        icon:"success"
      }
    }
  },
  async mounted(){
    const streakresult = await getStreak(USER_ID)
    if (streakresult.streak) {this.streak = streakresult.streak}
    else{this.streak = 1}
  },
  methods: {
    openDaily() {
      this.dailyIsOpen = true
    },
    openQRScan() {
      this.qrIsOpen = true
    },
    async onQRScan(payload){
      this.qrIsOpen = false
      if(payload.success) {
        const { success, points } = await verifyQR(USER_ID,payload.QRContent);
        if (success) {
          this.userMessage.mainMessage = 'QR scan is successfull!'
          if (points) {
            this.userMessage.subMessage = `You got extra ${points} Vodafone points!`
          } else {
            this.userMessage.subMessage = 'Your vodafone points are credited to your account'
          }
          this.userMessage.icon = 'success'     
        } else {
          this.userMessage.mainMessage = 'The scanned QR is not active'
          this.userMessage.subMessage = 'Please try to scan another treasure QR codes'
          this.userMessage.icon = 'error'
        }
      } else {
        this.userMessage.mainMessage = 'QR scanning has failed'
        this.userMessage.subMessage = 'Please try again'
        this.userMessage.icon = 'error'
      }
      this.userMessage.isVisible = true;
    },
    closeMessage(){
      this.userMessage.isVisible = false
    }
  }
};
</script>

<style scoped>

	.st0{fill:#FFFFFF;}
	.st1{fill:#E60000;}
	.st2{fill:#00FF87;}
	.st3{fill:none;}
  
.bmenuContainer{
    position: fixed;
    bottom: 0;
    width: 100vw;
}
#offcanvasBottom{
      height: 250px !important;
}
</style>
